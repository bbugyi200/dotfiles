#!/bin/bash

# Notification hook for Claude Code planning mode
# Called by PostToolUse hooks for ExitPlanMode and AskUserQuestion

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
LOG_FILE="$SCRIPT_DIR/../hooks.log"

# Get notification type from argument
NOTIFY_TYPE="${1:-unknown}"

# Get tmux window for prefix (same pattern as chez_stop_hook)
PREFIX="\[chez]"
if WINDOW=$(tmux display-message -p '#W' 2>/dev/null); then
    PREFIX="\[chez#${WINDOW}]"
fi

# Set notification based on type
case "$NOTIFY_TYPE" in
    question)
        TITLE="${PREFIX} Plan Question"
        MESSAGE="Claude is asking a question"
        ;;
    plan_complete)
        TITLE="${PREFIX} Plan Complete"
        MESSAGE="Planning phase finished - ready for review"
        ;;
    *)
        echo "[$(date '+%Y-%m-%d %H:%M:%S')] chez_notify_hook: unknown type: $NOTIFY_TYPE" >> "$LOG_FILE"
        exit 0
        ;;
esac

# Log and send notification
echo "[$(date '+%Y-%m-%d %H:%M:%S')] chez_notify_hook: $NOTIFY_TYPE - sending notification" >> "$LOG_FILE"
terminal-notifier -title "$TITLE" -message "$MESSAGE"

exit 0
