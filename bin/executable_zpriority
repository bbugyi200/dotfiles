#!/bin/bash
#
# Pretty Print High (@A), Medium (@B), or Low (@C) priority zorg TODOs.

function rgzp() {
  local letter="$1"
  shift
  rg -g '!*_done*' -g '!*snippets*' -g '!*.git*' "@$letter/" "$@" ~/org
}

function rgzp_count() {
  rgzp "$@" | wc -l | sed 's/^ *//'
}

function run() {
  if [[ -n "${1}" ]]; then
    local letter="$(echo $1 | tr '[:lower:]' '[:upper:]')"
    shift
  else
    local letter=A
  fi

  clear
  for f in $(rgzp $letter -l | sort -u); do
    echo -e " ${f/*org\//}\n###################################################"
    rg @$letter/ $f && echo
  done

  printf "\nFound %d @$letter priority TODOs in %d files.\n" \
    "$(rgzp_count $letter)" \
    "$(rgzp_count $letter -l)"
}

run "$@"
