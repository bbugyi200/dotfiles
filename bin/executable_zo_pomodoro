#!/bin/bash

source bugyi.sh

set -e

function run() {
  local day_log_file="${HOME}"/org/$(${DATE:-date} +%Y/%Y%m%d)_day.zo
  if ! [[ -f "${day_log_file}" ]]; then
    log::error "Today's day log file does NOT exist: %s" "${day_log_file}"
    return 1
  fi

  perl -nE 'print if /^======= p::/' "${day_log_file}" \
    | tail -n 1 \
    | perl -nE 'print s{.*::([1-9][0-9]*)\s+([012][0-9][0-5][0-9])}{P\1 @ \2}gr'
}

if [[ "${SCRIPTNAME}" == "$(basename "${BASH_SOURCE[0]}")" ]]; then
    run "$@"
fi
