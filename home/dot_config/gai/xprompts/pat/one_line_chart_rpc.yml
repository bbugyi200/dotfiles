input: { create_plan: { type: bool, default: false } }
xprompts:
  one_op_rpc: |
    We need to make sure we only make one RPC to populate the data for the line chart and we have decided to use the
    OnePlatform Reporting API (in particular, the FetchReport method defined in the
    google/ads/admanager/main/reporting/report_service.proto file) to accomplish this.
  file:
    input: { fname: word, query: text }
    content: |
      I need to add a new line chart to the PA troubleshooting page on (for Google Ad Manager's FE). #_one_op_rpc {{ query }}

      #file:{{ fname }}
  research: |
    Some research has already been done to help you with this task. Review these files before deciding on your implementation approach:
      - Prior Art (Existing Dart Clients): @bb/gai/file/prior_art.md
      - Required Dimensions and Metrics: @bb/gai/file/dimensions_metrics.md
steps:
  # Step 1: Run 3 research agents in parallel
  - name: research
    parallel:
      - name: prior_art
        prompt: |
          #_file(prior_art): Can you help me do some research on prior art in the form of other Dart clients that are
          currently using the OnePlatform Reporting API's FetchReport method?

      - name: dimensions_metrics
        prompt: |
          #_file(dimensions_metrics): Can you help me do some research on what specific dimensions and metrics we need
          to query from Reporting?

  # Step 2: Plan agent creates an implementation plan
  - name: plan
    if: "{{ create_plan }}"
    prompt: |
      #_file(plan): Can you help me write an implementation plan for this feature? #_research

  # Step 3: Implementation agent executes the plan
  - name: implementation
    prompt: |
      Can you help me improve the PA troubleshooting page by adding a line chart view in addition to the existing pie
      chart view? #_one_op_rpc

      - We shouldn't show the pie chart and the line chart at the same time ever. So make sure the user has a way to
        toggle between the two.
      - This code lives somewhere in the
        contentads/drx/fe/client/trafficking/private_marketplace/components/deal_check_ui/ directory.
      - This functionality should all be gated behind the ENABLE_PA_TROUBLESHOOTING_IMPROVEMENTS #feat.

      {% if create_plan -%}
      Use the following implementation plan to inspire your approach: @bb/gai/file/plan.md
      {% else -%}
      #_research
      {%- endif %}

      #commit:line_chart
