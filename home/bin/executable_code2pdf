#!/bin/bash

source ~/lib/bugyi.sh

# Main entry point.
function run() {
  if [[ $# -lt 2 ]]; then
    echo 1>&2 "Usage: code2pdf <pdf_stem> <code_file> [<code_file> ...]"
    exit 2
  fi

  pdf_stem="$1"
  shift

  pdf_path="$HOME"/org/lib/code/"$pdf_stem".pdf
  pandoc --toc \
    -V geometry:"left=1cm, top=1cm, right=1cm, bottom=2cm" -V fontsize=12pt \
    -f ~/lib/pandoc_code_reader.lua \
    "$@" \
    -o "$pdf_path"

  echo "PDF: file://${pdf_path}"
}

if [[ "${SCRIPTNAME}" == "$(basename "${BASH_SOURCE[0]}")" ]]; then
  run "$@"
fi
