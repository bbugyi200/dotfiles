#!/bin/bash

run() {
  if [[ $# -ne 2 ]]; then
    echo "Usage: $(basename "$0") <project> <N>"
    return 2
  fi

  local project="$1"
  shift

  local N="$1"
  shift

  local workspace_dir
  if [[ "$N" == "1" ]]; then
    workspace_dir=$GOOG_CLOUD_DIR/$project/$GOOG_SRC_DIR_BASE
  else
    workspace_dir=$GOOG_CLOUD_DIR/${project}_$N/$GOOG_SRC_DIR_BASE
  fi

  if ! [[ -d $workspace_dir ]]; then
    if [[ "$N" == "1" ]]; then
      echo "Error: Primary workspace directory '$workspace_dir' does not exist." >&2
      return 1
    else
      source /etc/bash_completion.d/hgd
      hgd -f --share-from "$project" "${project}_$N"
    fi
  fi

  echo "$workspace_dir"
}

run "$@"
