#!/bin/bash

# Find the most recently created gai workflow directory
# Output format: ~/.gai/projects/<project>/<workflow>/YYYYMMDDHHMMSS

GAI_BASE_DIR="$HOME/.gai/projects"

# Check if the base directory exists
if [[ ! -d "$GAI_BASE_DIR" ]]; then
  echo "Error: $GAI_BASE_DIR directory does not exist" >&2
  exit 1
fi

# Find the most recent directory by searching all projects and workflows
# Looking for pattern: ~/.gai/projects/<project>/<workflow>/<timestamp>
# where <timestamp> is YYYYMMDDHHMMSS (14 digits)
LATEST_DIR=$(find "$GAI_BASE_DIR" -mindepth 3 -maxdepth 3 -type d -name '[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]' | sort | tail -n 1)

if [[ -z "$LATEST_DIR" ]]; then
  echo "Error: No workflow directories found in $GAI_BASE_DIR/*/*/" >&2
  exit 1
fi

echo "$LATEST_DIR"
